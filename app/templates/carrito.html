{% extends 'base.html' %}
{% block title %}Ferremas - Carrito{% endblock %}
{% block extra_css %}<link rel="stylesheet" href="{{ url_for ('static', filename = 'css/style_carrito.css')}}">{% endblock %}
{% block content %}

      <div class="card">
        <div class="row">
            <div class="col-md-8 cart">
                <div class="title">
                    <div class="row">
                        <div class="col"><h4><b>Carro de compras</b></h4></div>
                        <div class="col align-self-center text-right text-muted">{{ pedidos|length }} producto(s)</div>
                        <div class="info-producto">
                            <ul>
                                {% for pedido in pedidos %}
                                    <li>
                                      <div class="informacion-producto">
                                        <p>{{ pedido['nom_pedido'] }}</p> <!-- Nombre -->
                                        <p>{{ pedido['desc_pedido'] }}</p> <!-- Categoria -->
                                      </div>


                                      <div class="acciones-producto">
                                        <p>${{ pedido['precio_pedido'] }}</p>  <!-- Precio unitario -->
                                        <p>Total: ${{ (pedido['precio_pedido'] * pedido['cantidad_total']) if pedido['precio_pedido'] is not none else '' }}</p>

                                        <form method="POST" action="{{ url_for('bp.disminuir_cantidad', id_pedido=pedido['id_pedido']) }}">
                                            <button type="submit">-</button>
                                        </form>
                                        <p>{{ pedido['cantidad_total'] }}</p>  <!-- Cantidad -->
                                        <form method="POST" action="{{ url_for('bp.aumentar_cantidad', product_id=pedido['id_pedido']) }}">
                                            <button type="submit">+</button>
                                        </form>
                                      </div>

                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="col-md-4 summary">
                <div><h5><b>Resumen de compra</b></h5></div>
                <hr>
                <div class="row">
          {% set subtotal = 0 %}
          {% for pedido in pedidos %}
            {% set linea = (pedido['precio_pedido'] * pedido['cantidad_total']) %}
            {% set subtotal = subtotal + linea %}
            <div class="col" style="padding-left:0;">{{ pedido['nom_pedido'] }}</div>
            <div class="col text-right">$ {{ linea }}</div>
          {% endfor %}
          <div class="col-12" style="padding-top:6px; border-top:1px solid #ccc;">Subtotal: $ {{ subtotal }}</div>
              </div>
                <div class="row" style="border-top: 1px solid rgba(0,0,0,.1); padding: 2vh 0;">
                    <div class="col">Descuento aplicado:</div>
                    <div class="col text-right">{{ descuento }}%</div>
                </div>
                <div class="row" style="border-top: 1px solid rgba(0,0,0,.1); padding: 2vh 0;">
                    <div class="col">TOTAL DE SU COMPRA:</div>
                    <div class="col text-right">${{ total_con_descuento }}</div> 
                </div>  
                <form action="{{ url_for('tbk.webpay_plus_create') if payment_available else url_for('_tbk_missing_create') }}" method="POST">
                    <input type="hidden" name="amount" value="{{ total_con_descuento|int }}">
                    {% if usuario %}
                      <button class="btn" type="submit">IR A PAGAR</button>
                    {% else %}
                      <button class="btn" type="button" disabled>INICIA SESIÃ“N PARA PAGAR</button>
                    {% endif %}
                </form>
                <div class="informacion-importante">
                  <h1>*Debes tener una cuenta para proceder al pago*</h1>
                </div>
            </div>
        </div>
    </div>
    
    
    

{% endblock %}