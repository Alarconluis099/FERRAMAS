{% extends 'base.html' %}
{% block title %}Registro - Ferremas{% endblock %}
{% block extra_css %}<link rel="stylesheet" href="{{ url_for('static', filename='css/style_login.css') }}">{% endblock %}
{% block content %}
<div class="auth-container">
  <div class="auth-card shadow-sm">
    <h1 class="auth-title">Crear cuenta</h1>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alerta alerta-flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  <form method='POST' action="{{ url_for('bp.guardar_registro')}}" data-validate novalidate>
    <div class="row g-3">
      <div class="col-12 form-group">
        <label for="reg-usuario">Usuario</label>
        <input id="reg-usuario" class="auth-input" type="text" name="usuario_nombre" placeholder="Tu nombre de usuario" required>
        <div class="error-text" data-error-for="usuario_nombre" aria-live="polite"></div>
      </div>
      <div class="col-12 form-group">
        <label for="reg-correo">Correo</label>
        <input id="reg-correo" class="auth-input" type="email" name="usuario_correo" placeholder="tuusuario@gmail.com" required>
        <div class="error-text" data-error-for="usuario_correo" aria-live="polite"></div>
      </div>
  <div class="col-12 form-group">
        <label for="reg-pass">Contraseña</label>
        <input id="reg-pass" class="auth-input" type="password" name="usuario_contraseña" placeholder="Mínimo 8 caracteres" required>
        <div class="error-text" data-error-for="usuario_contraseña" aria-live="polite"></div>
      </div>
    </div>
    <button type="submit" class="btn-auth w-100 mt-3">Registrar</button>
  </form>
    <p class="alt-link">¿Ya tienes cuenta? <a href="{{ url_for('bp.login') }}">Ingresar</a></p>
  </div>
</div>
{% endblock %}

{% block extra_js %}{{ super() }}
<script>
(function(){
  const form=document.querySelector('form[data-validate]');
  if(!form) return;
  const gmail=/^[A-Za-z0-9._%+-]+@gmail\.com$/;
  const rules={
  usuario_nombre:v=>!v&&'Usuario obligatorio',
    usuario_correo:v=>{if(!v) return 'Correo obligatorio'; if(!gmail.test(v)) return 'Debe ser @gmail.com';},
    usuario_contraseña:v=>{if(!v) return 'Contraseña obligatoria'; if(v.length<8) return 'Mínimo 8 caracteres';},
  // sin confirmación de contraseña
  };
  function setError(input,msg){const box=form.querySelector('.error-text[data-error-for="'+input.name+'"]'); if(!box) return; if(msg){input.classList.add('error'); box.textContent=msg; box.classList.add('active');} else {input.classList.remove('error'); box.textContent=''; box.classList.remove('active');}}
  function validate(i){const val=i.value.trim(); const fn=rules[i.name]; const err=fn?fn(val):null; setError(i,err); return !err;}
  form.addEventListener('submit',e=>{let ok=true; form.querySelectorAll('input').forEach(i=>{ if(!validate(i)) ok=false; }); if(!ok) e.preventDefault(); });
  form.addEventListener('input',e=>{ if(e.target.tagName==='INPUT') validate(e.target); });
})();
</script>
{% endblock %}
 
<!-- Limpieza de markup redundante eliminada -->

