{% extends 'base.html' %}
{% block title %}Login - Ferremas{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style_login.css') }}">
{% endblock %}
{% block content %}
<div class="auth-container">
  <div class="auth-card shadow-sm">
    <h1 class="auth-title">Ingresar</h1>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alerta alerta-flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <form method="POST" action="{{ url_for('bp.iniciar_sesion') }}" data-validate novalidate>
      <div class="form-group">
        <label for="login-correo">Correo o Usuario</label>
        <input id="login-correo" class="auth-input" type="text" name="usuario_correo" autocomplete="username" placeholder="usuario o correo@gmail.com" required>
        <div class="error-text" data-error-for="usuario_correo" aria-live="polite"></div>
      </div>
      <div class="form-group">
        <label for="login-pass">Contraseña</label>
        <input id="login-pass" class="auth-input" type="password" name="usuario_contraseña" autocomplete="current-password" placeholder="••••••••" required>
        <div class="error-text" data-error-for="usuario_contraseña" aria-live="polite"></div>
      </div>
        <div class="form-group remember-group">
          <input type="checkbox" id="remember-me" name="remember_me" value="1" class="remember-checkbox">
          <label for="remember-me" class="remember-label">Recuérdame por 30 días</label>
      </div>
      <button type="submit" class="btn-auth w-100">Ingresar</button>
    </form>
    <p class="alt-link">¿No tienes cuenta? <a href="{{ url_for('bp.registro') }}">Crear una cuenta</a></p>
  </div>
</div>
{% endblock %}

{% block extra_js %}{{ super() }}
<script>
(function(){
  const form = document.querySelector('form[data-validate]');
  if(!form) return;
  const rules = {
    usuario_correo: v => { if(!v) return 'Campo obligatorio'; const email=/^[A-Za-z0-9._%+-]+@gmail\.com$/; const user=/^[A-Za-z0-9._-]{3,}$/; if(!(email.test(v)||user.test(v))) return 'Ingresa correo @gmail.com o usuario válido (>=3)';},
    usuario_contraseña: v => { if(!v) return 'La contraseña es obligatoria'; if(v.length < 8) return 'Mínimo 8 caracteres'; }
  };
  function setError(input,msg){ const box=form.querySelector('.error-text[data-error-for="'+input.name+'"]'); if(!box) return; if(msg){ input.classList.add('error'); box.textContent=msg; box.classList.add('active'); } else { input.classList.remove('error'); box.textContent=''; box.classList.remove('active'); } }
  function validateInput(input){ const val=input.value.trim(); const rule=rules[input.name]; const err=rule?rule(val):(!val && input.hasAttribute('required')?'Campo obligatorio':null); setError(input,err); return !err; }
  form.addEventListener('submit',e=>{ let ok=true; form.querySelectorAll('input').forEach(i=>{ if(!validateInput(i)) ok=false; }); if(!ok) e.preventDefault(); });
  form.addEventListener('blur',e=>{ if(e.target.tagName==='INPUT') validateInput(e.target); },true);
})();
</script>
{% endblock %}


